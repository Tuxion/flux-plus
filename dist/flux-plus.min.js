!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.FluxPlus=t()}}(function(){return function t(e,r,n){function o(s,a){if(!r[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[s]={exports:{}};e[s][0].call(p.exports,function(t){var r=e[s][1][t];return o(r?r:t)},p,p.exports,t,e,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e){e.exports={ActionSource:{CLIENT:"CLIENT",SERVER:"SERVER"},EntityOperation:{MERGE:"MERGE",DELETE:"DELETE",REPLACE:"REPLACE"}}},{}],2:[function(t,e){var r,n={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};e.exports=r=function(t){function e(t){this.message=t,this.name="InvalidArgumentError",e.__super__.constructor.apply(this,arguments)}return o(e,t),e}(Error)},{}],3:[function(t,e){var r,n={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};e.exports=r=function(t){function e(t){this.message=t,this.name="ValidationError",e.__super__.constructor.apply(this,arguments)}return o(e,t),e}(Error)},{}],4:[function(t,e){var r,n,o;o=t("src/actions/constants"),r=o.ActionSource,n=o.EntityOperation,e.exports={errors:t("src/errors"),Dispatcher:t("src/dispatcher/dispatcher"),Action:t("src/actions/action"),ActionSource:r,EntityOperation:n,BaseStore:t("src/stores/base-store")}},{"src/actions/action":5,"src/actions/constants":6,"src/dispatcher/dispatcher":7,"src/errors":8,"src/stores/base-store":9}],5:[function(t,e){var r,n,o,i,s;s=t("./constants"),n=s.ActionSource,o=s.EntityOperation,i=t("src/errors").ValidationError,e.exports=r=function(){function t(){this.active={},this.entities={},this.payload={}}return t.prototype.name=null,t.prototype.source=null,t.prototype.active=null,t.prototype.entities=null,t.prototype.payload=null,t.prototype.validate=function(){var t,e,r,s;if(!this.name)throw new i("Action name is not defined.");if(!n[this.source])throw new i("Source '"+this.source+"' is not a valid ActionSource.");r=this.payload,s=[];for(e in r){if(t=r[e],!this.entities[e])throw new i("Payload with key '"+e+"' is not defined in the entities.");if(!o[this.entities[e]])throw new i("Entity '"+e+"' has an invalid EntityOperation '"+this.entities[e]+"'.");if(!Array.isArray(t))throw new i("Payload with key '"+e+"' is not an Array.");s.push(void 0)}return s},t}()},{"./constants":1,"src/errors":8}],6:[function(t,e){e.exports={ActionSource:{CLIENT:"CLIENT",SERVER:"SERVER"},EntityOperation:{MERGE:"MERGE",DELETE:"DELETE",REPLACE:"REPLACE"}}},{}],7:[function(t,e){var r,n,o,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};o=t("src/errors").InvalidArgumentError,r=t("src/actions/action"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.dispatch=function(t){if(!(t instanceof r))throw new o("Payload must be an instance of Action.");return t.validate(),e.__super__.dispatch.apply(this,arguments)},e}(Flux.Dispatcher)},{"src/actions/action":5,"src/errors":8}],8:[function(t,e){e.exports={ValidationError:t("./validation-error"),InvalidArgumentError:t("./invalid-argument-error")}},{"./invalid-argument-error":2,"./validation-error":3}],9:[function(t,e){var r,n,o,i,s,a,c={}.hasOwnProperty,u=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=t("src/actions/constants"),r=a.ActionSource,i=a.EntityOperation,s=t("src/errors").InvalidArgumentError,o=t("src/dispatcher/dispatcher"),e.exports=n=function(t){function e(t){if(!(t instanceof o))throw new s("An instance of FluxPlus.Dispatcher should be provided.");if(null==this.elementName)throw new Error('The property "elementName" must be set on implementations of the BaseStore.');this._elements={},this._refs={active:null},this.dispatcherIndex=t.register(function(t){return function(e){return t.handleAction(e)}}(this))}return u(e,t),e.prototype.elementName=null,e.prototype._elements=null,e.prototype._refs=null,e.prototype.extractId=function(t){return t.id},e.prototype.extractActive=function(t){var e,r;return e=null!=(r=t.active)?r[this.elementName]:void 0,void 0===e?!1:e},e.prototype.getActive=function(){return this._refs.active},e.prototype.getOne=function(t){return t instanceof Object&&(t=this.extractId(t)),this._elements[t]||null},e.prototype.getAll=function(){var t,e,r,n;t={},n=this._elements;for(e in n)r=n[e],t[e]=r;return t},e.prototype.handleAction=function(t){var e,n,o,s,a,c,u,p,l,f,h;if(e=this.extractActive(t),e!==!1&&(this._refs.active=e,t.source=r.CLIENT))return void this.emit("change");if(t.source===r.SERVER&&t.entities[this.elementName]){switch(t.entities[this.elementName]){case i.REPLACE:for(this._elements={},l=t.payload[this.elementName],o=0,c=l.length;c>o;o++)n=l[o],this._elements[this.extractId(n)]=n;break;case i.MERGE:for(f=t.payload[this.elementName],s=0,u=f.length;u>s;s++)n=f[s],this._elements[this.extractId(n)]=n;break;case i.DELETE:for(h=t.payload[this.elementName],a=0,p=h.length;p>a;a++)n=h[a],delete this._elements[this.extractId(n)]}this.emit("change")}},e}(EventEmitter)},{"src/actions/constants":6,"src/dispatcher/dispatcher":7,"src/errors":8}]},{},[4])(4)});